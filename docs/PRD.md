# 쿠팡 클론 프로젝트 - 상세 요구사항 및 기획서 (PRD)

> **Version**: 1.0
> **Last Updated**: 2025-12-19
> **Tech Stack**: Java 17 + Spring Boot 3.x + WebFlux + R2DBC + MySQL + Redis

---

## 1. 프로젝트 개요

### 1.1 비전
대한민국 1위 이커머스 플랫폼 쿠팡의 핵심 기능을 구현하여, 대규모 트래픽과 복잡한 비즈니스 로직을 처리하는 고성능 이커머스 시스템 개발

### 1.2 핵심 가치
| 가치 | 설명 |
|------|------|
| **속도** | 로켓배송 - 주문 후 익일(또는 당일) 배송 |
| **편의성** | 원클릭 결제, 간편한 반품/환불 |
| **신뢰성** | 100% 정품 보장, 투명한 리뷰 시스템 |
| **가격 경쟁력** | 와우 멤버십, 적립금, 쿠폰 혜택 |

### 1.3 목표 사용자
- **구매자**: 일반 소비자, 와우 멤버십 회원
- **판매자**: 로켓배송 입점사, 마켓플레이스 셀러
- **관리자**: 운영팀, CS팀, 물류팀

---

## 2. 시스템 아키텍처

### 2.1 전체 아키텍처
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Client Layer                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   Web App   │  │ Mobile App  │  │ Seller App  │  │  Admin App  │        │
│  │   (React)   │  │(iOS/Android)│  │   (React)   │  │   (React)   │        │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
└───────────────────────────────┬─────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           API Gateway (Kong/Nginx)                           │
│  • Rate Limiting  • Authentication  • Load Balancing  • SSL Termination     │
└───────────────────────────────┬─────────────────────────────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        ▼                       ▼                       ▼
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│  Member API   │       │  Product API  │       │   Order API   │
│   (WebFlux)   │       │   (WebFlux)   │       │   (WebFlux)   │
└───────────────┘       └───────────────┘       └───────────────┘
        │                       │                       │
        ▼                       ▼                       ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Data Layer                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐           │
│  │ MySQL   │  │  Redis  │  │Elastic  │  │   S3    │  │  Kafka  │           │
│  │(R2DBC)  │  │ (Cache) │  │ Search  │  │ (Image) │  │ (Event) │           │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 도메인 구조 (DDD)
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Bounded Contexts                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                  │
│  │   Member     │    │   Product    │    │   Order      │                  │
│  │   Context    │◀──▶│   Context    │◀──▶│   Context    │                  │
│  ├──────────────┤    ├──────────────┤    ├──────────────┤                  │
│  │ • 회원       │    │ • 상품       │    │ • 주문       │                  │
│  │ • 인증       │    │ • 카테고리   │    │ • 주문상품   │                  │
│  │ • 배송지     │    │ • 옵션       │    │ • 배송       │                  │
│  │ • 등급       │    │ • 재고       │    │ • 반품/환불  │                  │
│  │ • 멤버십     │    │ • 리뷰       │    │              │                  │
│  └──────────────┘    └──────────────┘    └──────────────┘                  │
│         │                   │                   │                          │
│         ▼                   ▼                   ▼                          │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                  │
│  │   Payment    │    │   Promotion  │    │   Seller     │                  │
│  │   Context    │◀──▶│   Context    │◀──▶│   Context    │                  │
│  ├──────────────┤    ├──────────────┤    ├──────────────┤                  │
│  │ • 결제       │    │ • 쿠폰       │    │ • 판매자     │                  │
│  │ • 환불       │    │ • 프로모션   │    │ • 정산       │                  │
│  │ • 쿠팡페이   │    │ • 적립금     │    │ • 상품관리   │                  │
│  └──────────────┘    └──────────────┘    └──────────────┘                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 기능 요구사항 (Functional Requirements)

### 3.1 회원 도메인 (Member Domain)

#### 3.1.1 회원가입/로그인
| ID | 요구사항 | 우선순위 | 상세 |
|----|---------|---------|------|
| M-001 | 이메일 회원가입 | P0 | 이메일 인증 필수, 비밀번호 정책 적용 |
| M-002 | 소셜 로그인 | P1 | 카카오, 네이버, 구글, 애플 |
| M-003 | 휴대폰 본인인증 | P0 | 성인인증, 중복가입 방지 |
| M-004 | JWT 기반 인증 | P0 | Access Token (1h) + Refresh Token (7d) |
| M-005 | 자동 로그인 | P1 | 디바이스별 토큰 관리, 최대 5대 |

**비밀번호 정책**:
- 최소 8자 이상
- 영문 대/소문자, 숫자, 특수문자 중 3종류 이상 조합
- 연속된 문자 3개 이상 불가 (예: abc, 123)
- 아이디와 동일 불가

#### 3.1.2 회원 등급
```
┌─────────────────────────────────────────────────────────────────────┐
│                        회원 등급 체계                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐       │
│    │ BRONZE  │───▶│ SILVER  │───▶│  GOLD   │───▶│   VIP   │       │
│    │   1%    │    │   2%    │    │   3%    │    │   5%    │       │
│    │  기본   │    │ 10만원  │    │ 50만원  │    │ 100만원 │       │
│    └─────────┘    └─────────┘    └─────────┘    └─────────┘       │
│                                                                     │
│    ※ 적립률은 결제금액 기준                                         │
│    ※ 등급 산정: 최근 6개월 구매 금액 기준, 매월 1일 갱신            │
│    ※ 등급 유지: 3개월간 등급 유지, 이후 재산정                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 3.1.3 와우 멤버십 (Coupang WOW)
| ID | 요구사항 | 상세 |
|----|---------|------|
| M-010 | 멤버십 가입 | 월 4,990원 / 연 49,900원 |
| M-011 | 무료 배송 | 로켓배송 상품 무료 배송 (최소금액 없음) |
| M-012 | 무료 반품 | 30일 이내 무료 반품 |
| M-013 | 로켓프레시 할인 | 신선식품 10% 추가 할인 |
| M-014 | 와우 전용 할인 | 와우 전용 쿠폰 및 특가 |
| M-015 | 쿠팡플레이 | OTT 서비스 무료 이용 (Phase 3) |
| M-016 | 자동 결제 | 매월/매년 자동 갱신, 해지 가능 |

#### 3.1.4 배송지 관리
| ID | 요구사항 | 상세 |
|----|---------|------|
| M-020 | 배송지 등록 | 최대 10개, 기본 배송지 1개 지정 |
| M-021 | 주소 검색 | 도로명/지번 주소 검색 (Kakao API) |
| M-022 | 배송 가능 지역 | 도서산간 지역 확인, 추가 배송비 안내 |
| M-023 | 배송지별 수령인 | 수령인 이름, 연락처 별도 관리 |
| M-024 | 공동현관 출입 | 공동현관 비밀번호, 경비실 호출 등 |

---

### 3.2 상품 도메인 (Product Domain)

#### 3.2.1 상품 등록/관리
| ID | 요구사항 | 우선순위 | 상세 |
|----|---------|---------|------|
| P-001 | 상품 기본 정보 | P0 | 상품명, 설명, 가격, 카테고리 |
| P-002 | 상품 이미지 | P0 | 대표이미지 1개 + 추가이미지 최대 9개 |
| P-003 | 상품 옵션 | P0 | 2단계 옵션 (색상×사이즈), 옵션별 가격/재고 |
| P-004 | 상품 상태 | P0 | 판매중/일시품절/판매중지/삭제 |
| P-005 | 배송 유형 | P0 | 로켓배송/로켓프레시/로켓직구/일반배송 |
| P-006 | 상품 상세 | P1 | HTML 에디터, 이미지/동영상 삽입 |

#### 3.2.2 배송 유형별 특성
```
┌─────────────────────────────────────────────────────────────────────┐
│                         배송 유형 정의                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   로켓배송      │  쿠팡 물류센터 직접 배송                       │
│  │   ROCKET        │  • 무료배송: 19,800원 이상 (와우 회원 무제한)  │
│  │                 │  • 배송시간: 당일/익일 (자정 전 주문시)        │
│  │                 │  • 반품: 30일 이내 무료                        │
│  └─────────────────┘                                               │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   로켓프레시    │  신선식품 새벽배송                             │
│  │   ROCKET_FRESH  │  • 무료배송: 15,000원 이상                    │
│  │                 │  • 배송시간: 새벽 7시 전 (밤 10시 전 주문시)   │
│  │                 │  • 냉장/냉동 보관 배송                         │
│  └─────────────────┘                                               │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   로켓직구      │  해외 직접 구매 대행                           │
│  │   ROCKET_GLOBAL │  • 무료배송: 35,000원 이상                    │
│  │                 │  • 배송시간: 3~7일                            │
│  │                 │  • 관세/부가세 포함 가격                       │
│  └─────────────────┘                                               │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   일반배송      │  판매자 직접 배송                              │
│  │   NORMAL        │  • 무료배송: 판매자별 상이 (기본 30,000원)    │
│  │                 │  • 배송시간: 2~5일                            │
│  │                 │  • 배송비: 기본 3,000원                        │
│  └─────────────────┘                                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 3.2.3 카테고리
| ID | 요구사항 | 상세 |
|----|---------|------|
| P-010 | 카테고리 계층 | 3단계 (대분류 > 중분류 > 소분류) |
| P-011 | 카테고리별 속성 | 카테고리별 필수 속성 정의 (의류: 소재, 시즌 등) |
| P-012 | 카테고리 정렬 | 관리자 지정 순서대로 노출 |

**주요 카테고리 예시**:
```
패션의류
├── 여성의류
│   ├── 원피스
│   ├── 티셔츠
│   └── 바지
├── 남성의류
│   ├── 티셔츠
│   └── 바지
└── 유아동의류

식품
├── 신선식품
│   ├── 과일
│   ├── 채소
│   └── 정육/계란
├── 가공식품
└── 음료/생수

가전디지털
├── 컴퓨터/노트북
├── 휴대폰/태블릿
└── TV/영상가전
```

#### 3.2.4 재고 관리
| ID | 요구사항 | 우선순위 | 상세 |
|----|---------|---------|------|
| P-020 | 옵션별 재고 | P0 | 각 옵션 조합별 독립적 재고 관리 |
| P-021 | 재고 예약 | P0 | 주문 시 재고 예약 → 결제 완료 시 확정 |
| P-022 | 동시성 제어 | P0 | 낙관적 락 + 재시도 (3회) |
| P-023 | 품절 처리 | P0 | 재고 0시 자동 품절 표시, 재입고 알림 신청 |
| P-024 | 안전 재고 | P1 | 안전 재고 이하 시 알림 |

**재고 차감 플로우**:
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  주문 요청  │────▶│  재고 예약  │────▶│  결제 완료  │────▶│  재고 확정  │
│             │     │ (reserved++) │    │             │     │ (quantity--)│
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                           │                                       │
                           │ 결제 실패/취소                        │ 반품
                           ▼                                       ▼
                    ┌─────────────┐                         ┌─────────────┐
                    │  예약 해제  │                         │  재고 복구  │
                    │(reserved--)│                         │(quantity++)│
                    └─────────────┘                         └─────────────┘
```

---

### 3.3 장바구니 도메인 (Cart Domain)

#### 3.3.1 장바구니 기능
| ID | 요구사항 | 우선순위 | 상세 |
|----|---------|---------|------|
| C-001 | 상품 담기 | P0 | 옵션 선택 후 수량 지정하여 담기 |
| C-002 | 수량 변경 | P0 | 1~99개 (상품별 최대 구매 수량 제한) |
| C-003 | 상품 삭제 | P0 | 개별 삭제, 선택 삭제, 전체 삭제 |
| C-004 | 품절 상품 처리 | P0 | 품절 상품 선택 불가, 삭제 유도 |
| C-005 | 가격 변경 알림 | P1 | 장바구니 담긴 후 가격 변경 시 알림 |
| C-006 | 선택 구매 | P0 | 체크박스로 구매할 상품 선택 |

#### 3.3.2 장바구니 UI 구조
```
┌─────────────────────────────────────────────────────────────────────┐
│  ☑ 전체 선택 (3/5)                              🗑️ 선택 삭제        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─ 로켓배송 ─────────────────────────────────────────────────────┐ │
│  │ ☑ [이미지] 상품명 A                                           │ │
│  │            옵션: 블랙 / XL                                     │ │
│  │            19,900원  [-] 2 [+]              합계: 39,800원    │ │
│  │ ─────────────────────────────────────────────────────────────│ │
│  │ ☑ [이미지] 상품명 B                                           │ │
│  │            옵션: 화이트                                        │ │
│  │            12,000원  [-] 1 [+]              합계: 12,000원    │ │
│  │ ─────────────────────────────────────────────────────────────│ │
│  │           로켓배송 소계: 51,800원 | 배송비: 무료               │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  ┌─ 일반배송 (판매자: ABC마트) ─────────────────────────────────┐  │
│  │ ☐ [이미지] 상품명 C (품절)                                    │ │
│  │            옵션: 레드 / M                                      │ │
│  │            ❌ 품절된 상품입니다                        [삭제]  │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│  상품금액: 51,800원                                                 │
│  배송비: 0원 (로켓배송 무료)                                        │
│  ─────────────────────────────                                      │
│  결제예정금액: 51,800원                                             │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    주문하기 (2개)                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 3.4 주문 도메인 (Order Domain)

#### 3.4.1 주문 생성
| ID | 요구사항 | 우선순위 | 상세 |
|----|---------|---------|------|
| O-001 | 장바구니 주문 | P0 | 장바구니 선택 상품 주문 |
| O-002 | 바로 구매 | P0 | 상품 상세에서 바로 주문 |
| O-003 | 배송지 선택 | P0 | 기존 배송지 선택 또는 신규 입력 |
| O-004 | 배송 요청사항 | P0 | 문앞, 경비실, 택배함, 직접입력 |
| O-005 | 주문번호 생성 | P0 | 형식: YYYYMMDD + 8자리 랜덤 |

#### 3.4.2 주문 상태 머신
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            주문 상태 전이도                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐                                                        │
│    │ 결제대기     │──────────────────────────────────────┐                 │
│    │ PENDING      │                                      │ 결제시간초과     │
│    └──────────────┘                                      │ (30분)          │
│           │                                              ▼                 │
│           │ 결제완료                              ┌──────────────┐         │
│           ▼                                       │ 주문취소     │         │
│    ┌──────────────┐                               │ CANCELLED    │         │
│    │ 결제완료     │───────취소요청───────────────▶│              │         │
│    │ PAID         │                               └──────────────┘         │
│    └──────────────┘                                      ▲                 │
│           │                                              │                 │
│           │ 상품준비                                     │                 │
│           ▼                                              │                 │
│    ┌──────────────┐                                      │                 │
│    │ 상품준비중   │───────취소요청────────────────────────┤                 │
│    │ PREPARING    │                                      │                 │
│    └──────────────┘                                      │                 │
│           │                                              │                 │
│           │ 출고                                         │                 │
│           ▼                                              │                 │
│    ┌──────────────┐     배송중에는 취소 불가             │                 │
│    │ 배송중       │     (배송완료 후 반품 가능)          │                 │
│    │ SHIPPING     │                                      │                 │
│    └──────────────┘                                      │                 │
│           │                                              │                 │
│           │ 배송완료                                     │                 │
│           ▼                                              │                 │
│    ┌──────────────┐                               ┌──────────────┐         │
│    │ 배송완료     │─────────반품요청─────────────▶│ 반품요청     │         │
│    │ DELIVERED    │                               │ RETURN_REQ   │         │
│    └──────────────┘                               └──────────────┘         │
│           │                                              │                 │
│           │ 구매확정                                     │ 반품승인        │
│           │ (7일 자동확정)                               ▼                 │
│           ▼                                       ┌──────────────┐         │
│    ┌──────────────┐                               │ 반품완료     │         │
│    │ 구매확정     │                               │ RETURNED     │         │
│    │ CONFIRMED    │                               └──────────────┘         │
│    └──────────────┘                                                        │
│           │                                                                │
│           │ 적립금 지급                                                    │
│           ▼                                                                │
│    ┌──────────────┐                                                        │
│    │ 적립완료     │                                                        │
│    │ COMPLETED    │                                                        │
│    └──────────────┘                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 3.4.3 주문 상세 비즈니스 규칙
| 규칙 | 설명 |
|------|------|
| 취소 가능 시점 | 배송중 상태 이전까지만 취소 가능 |
| 부분 취소 | 주문 내 개별 상품 취소 가능 (배송 전) |
| 자동 구매확정 | 배송완료 후 7일 경과 시 자동 구매확정 |
| 적립금 지급 | 구매확정 시 등급별 적립률 적용하여 지급 |
| 반품 기한 | 배송완료 후 30일 이내 (와우 회원) / 7일 이내 (일반) |

#### 3.4.4 주문 API
```
POST   /api/v1/orders                    # 주문 생성
GET    /api/v1/orders                    # 주문 목록 (페이징)
GET    /api/v1/orders/{orderNumber}      # 주문 상세
POST   /api/v1/orders/{orderNumber}/cancel              # 주문 전체 취소
POST   /api/v1/orders/{orderNumber}/items/{itemId}/cancel  # 부분 취소
POST   /api/v1/orders/{orderNumber}/confirm             # 구매 확정
POST   /api/v1/orders/{orderNumber}/return              # 반품 요청
```

---

### 3.5 결제 도메인 (Payment Domain)

#### 3.5.1 결제 수단
| 결제 수단 | 우선순위 | 상세 |
|----------|---------|------|
| 신용/체크카드 | P0 | 국내 전 카드사, 할부 (2~12개월) |
| 쿠팡페이 | P0 | 간편결제, 카드/계좌 등록 |
| 네이버페이 | P1 | 네이버페이 연동 |
| 카카오페이 | P1 | 카카오페이 연동 |
| 토스페이 | P1 | 토스페이 연동 |
| 무통장입금 | P0 | 가상계좌 발급, 24시간 내 입금 |
| 휴대폰 결제 | P2 | 통신사 결제 (5만원 한도) |
| 쿠팡캐시 | P1 | 충전식 선불 캐시 |

#### 3.5.2 복합 결제
| ID | 요구사항 | 상세 |
|----|---------|------|
| PM-001 | 적립금 + 결제 | 적립금 우선 차감 후 나머지 결제 |
| PM-002 | 쿠폰 + 결제 | 쿠폰 할인 후 결제 금액 산정 |
| PM-003 | 쿠팡캐시 + 결제 | 쿠팡캐시 우선 차감 후 나머지 결제 |

#### 3.5.3 결제 플로우
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  주문 확인  │────▶│ 결제수단    │────▶│  PG 결제    │────▶│  결제완료   │
│  (금액확인) │     │  선택       │     │  요청/승인  │     │  처리       │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                                               │
                                               │ 실패
                                               ▼
                                        ┌─────────────┐
                                        │  결제실패   │
                                        │  재시도/취소│
                                        └─────────────┘

[결제완료 후]
1. 재고 확정 (예약 → 실제 차감)
2. 쿠폰 사용 처리
3. 적립금 차감
4. 주문 상태 변경 (PENDING → PAID)
5. 알림 발송 (이메일/푸시)
```

#### 3.5.4 환불 정책
| 상황 | 환불 방법 | 소요 시간 |
|------|----------|----------|
| 카드 결제 취소 | 카드사 승인취소 | 영업일 3~5일 |
| 무통장 입금 환불 | 계좌 이체 | 영업일 1~3일 |
| 간편결제 환불 | 해당 결제사 환불 | 즉시~3일 |
| 부분 환불 | 부분 금액 환불 | 동일 |

---

### 3.6 쿠폰/프로모션 도메인 (Promotion Domain)

#### 3.6.1 쿠폰 유형
```
┌─────────────────────────────────────────────────────────────────────┐
│                          쿠폰 유형 정의                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   정액 할인     │  ex) 3,000원 할인                             │
│  │   FIXED_AMOUNT  │  • 최소 주문금액 조건 가능                    │
│  │                 │  • 할인금액 > 상품금액 시 상품금액만큼만 할인  │
│  └─────────────────┘                                               │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   정률 할인     │  ex) 10% 할인                                 │
│  │   PERCENTAGE    │  • 최대 할인금액 제한 가능                    │
│  │                 │  • ex) 10% 할인 (최대 5,000원)               │
│  └─────────────────┘                                               │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │   무료 배송     │  배송비 무료 쿠폰                             │
│  │   FREE_SHIPPING │  • 일반배송 상품에만 적용                     │
│  └─────────────────┘                                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 3.6.2 쿠폰 적용 조건
| 조건 | 설명 |
|------|------|
| 최소 주문금액 | ex) 30,000원 이상 구매 시 사용 가능 |
| 적용 카테고리 | 특정 카테고리 상품에만 적용 |
| 적용 상품 | 특정 상품에만 적용 |
| 적용 셀러 | 특정 판매자 상품에만 적용 |
| 사용 기한 | 발급일로부터 N일 / 특정 기간 |
| 사용 횟수 | 1회 / 무제한 (기간 내) |
| 중복 사용 | 다른 쿠폰과 중복 사용 가능 여부 |

#### 3.6.3 쿠폰 발급 방식
| ID | 방식 | 상세 |
|----|------|------|
| CP-001 | 자동 발급 | 신규가입, 생일, 등급 승급 시 자동 발급 |
| CP-002 | 다운로드 | 이벤트 페이지에서 다운로드 (선착순 가능) |
| CP-003 | 코드 입력 | 쿠폰 코드 입력하여 등록 |
| CP-004 | 조건 충족 | 특정 조건 충족 시 자동 발급 (첫 구매, N만원 이상 구매 등) |

#### 3.6.4 쿠폰 사용 규칙
```java
// 쿠폰 적용 우선순위
1. 상품 쿠폰 (특정 상품에만 적용)
2. 카테고리 쿠폰 (특정 카테고리에만 적용)
3. 장바구니 쿠폰 (전체 주문에 적용)
4. 배송비 쿠폰

// 중복 적용 규칙
- 상품 쿠폰: 상품당 1개만 적용
- 카테고리 쿠폰: 주문당 1개만 적용
- 장바구니 쿠폰: 주문당 1개만 적용
- 배송비 쿠폰: 주문당 1개만 적용
- 각 유형별로 1개씩 중복 사용 가능 (총 4개까지)
```

---

### 3.7 리뷰 도메인 (Review Domain)

#### 3.7.1 리뷰 작성
| ID | 요구사항 | 상세 |
|----|---------|------|
| R-001 | 리뷰 작성 자격 | 구매확정된 상품만 리뷰 작성 가능 |
| R-002 | 평점 | 1~5점 (필수) |
| R-003 | 텍스트 리뷰 | 10~2000자 |
| R-004 | 포토 리뷰 | 최대 8장, 각 10MB 이하 |
| R-005 | 동영상 리뷰 | 최대 1개, 30초~60초, 100MB 이하 |
| R-006 | 한달사용 리뷰 | 첫 리뷰 작성 30일 후 추가 리뷰 작성 가능 |
| R-007 | 리뷰 수정 | 작성 후 90일 이내 수정 가능 |
| R-008 | 리뷰 삭제 | 본인 리뷰만 삭제 가능 |

#### 3.7.2 리뷰 보상
| 리뷰 유형 | 보상 |
|----------|------|
| 텍스트 리뷰 (10자 이상) | 50원 |
| 텍스트 리뷰 (100자 이상) | 100원 |
| 포토 리뷰 | 150원 |
| 동영상 리뷰 | 200원 |
| 한달사용 리뷰 | 100원 추가 |

#### 3.7.3 리뷰 통계
```
┌─────────────────────────────────────────────────────────────────────┐
│  상품 리뷰 통계                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ⭐ 4.5 / 5.0                    전체 리뷰 1,234개                  │
│                                                                     │
│  5점 ████████████████████████████░░ 789개 (64%)                    │
│  4점 ██████████░░░░░░░░░░░░░░░░░░░░ 234개 (19%)                    │
│  3점 ████░░░░░░░░░░░░░░░░░░░░░░░░░░ 98개  (8%)                     │
│  2점 ██░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 56개  (5%)                     │
│  1점 █░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 57개  (5%)                     │
│                                                                     │
│  [포토/동영상 리뷰만] [최신순 ▼]                                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 3.8 판매자 도메인 (Seller Domain)

#### 3.8.1 판매자 유형
| 유형 | 설명 |
|------|------|
| 로켓배송 입점사 | 쿠팡 물류센터에 상품 입고, 쿠팡이 배송 |
| 마켓플레이스 셀러 | 판매자가 직접 배송 |
| 로켓직구 파트너 | 해외 상품 직구 파트너 |

#### 3.8.2 판매자 기능
| ID | 요구사항 | 상세 |
|----|---------|------|
| S-001 | 판매자 가입 | 사업자등록증 인증 필수 |
| S-002 | 상품 등록 | 카테고리별 상품 등록 |
| S-003 | 주문 관리 | 주문 확인, 발송 처리 |
| S-004 | 정산 조회 | 일별/월별 정산 내역 조회 |
| S-005 | 문의 관리 | 상품 문의, 1:1 문의 답변 |
| S-006 | 리뷰 관리 | 리뷰 확인, 판매자 답변 |
| S-007 | 통계/분석 | 매출, 주문, 상품별 통계 |

#### 3.8.3 정산 체계
```
┌─────────────────────────────────────────────────────────────────────┐
│                         정산 프로세스                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  구매확정 ──▶ 정산대상 등록 ──▶ 수수료 차감 ──▶ 지급                 │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  정산 주기: 주 1회 (매주 목요일)                             │   │
│  │  정산 기준: 전주 월~일 구매확정 건                           │   │
│  │  지급일: 정산 후 영업일 2일 이내                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  수수료 체계                                                 │   │
│  │  • 로켓배송: 카테고리별 10~15%                               │   │
│  │  • 마켓플레이스: 카테고리별 8~12%                            │   │
│  │  • 결제 수수료: 별도 (PG 수수료)                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. 비기능 요구사항 (Non-Functional Requirements)

### 4.1 성능 (Performance)
| 항목 | 요구사항 |
|------|---------|
| API 응답시간 | 평균 200ms 이하, P99 500ms 이하 |
| 동시 접속자 | 10,000명 이상 처리 |
| TPS | 1,000 TPS 이상 (주문 처리) |
| 가용성 | 99.9% 이상 (연간 다운타임 8.76시간 이하) |

### 4.2 확장성 (Scalability)
| 항목 | 전략 |
|------|------|
| 수평 확장 | Kubernetes 기반 Auto Scaling |
| DB 확장 | Read Replica, 샤딩 (Phase 3) |
| 캐시 | Redis Cluster |
| 이벤트 처리 | Kafka (비동기 처리) |

### 4.3 보안 (Security)
| 항목 | 요구사항 |
|------|---------|
| 인증 | JWT + Refresh Token |
| 암호화 | HTTPS (TLS 1.3), 비밀번호 BCrypt |
| 개인정보 | 개인정보 암호화 저장, 마스킹 표시 |
| 결제 보안 | PCI-DSS 준수 (PG사 위임) |
| 보안 테스트 | OWASP Top 10 취약점 점검 |

### 4.4 모니터링 (Monitoring)
| 항목 | 도구 |
|------|------|
| APM | Datadog / New Relic |
| 로그 | ELK Stack (Elasticsearch + Logstash + Kibana) |
| 메트릭 | Prometheus + Grafana |
| 알림 | Slack, PagerDuty |
| 트레이싱 | Jaeger / Zipkin |

---

## 5. 데이터베이스 설계

### 5.1 주요 테이블 목록
```
┌─────────────────────────────────────────────────────────────────────┐
│  Core Tables                                                        │
├─────────────────────────────────────────────────────────────────────┤
│  members              회원 정보                                      │
│  addresses            배송지                                         │
│  memberships          와우 멤버십                                    │
│  sellers              판매자                                         │
│  categories           카테고리 (계층)                                │
│  products             상품                                           │
│  product_options      상품 옵션                                      │
│  product_images       상품 이미지                                    │
│  inventories          재고                                           │
│  carts                장바구니                                       │
│  cart_items           장바구니 상품                                  │
│  orders               주문                                           │
│  order_items          주문 상품                                      │
│  payments             결제                                           │
│  deliveries           배송                                           │
│  delivery_histories   배송 이력                                      │
│  coupons              쿠폰 정의                                      │
│  member_coupons       회원 보유 쿠폰                                 │
│  reviews              리뷰                                           │
│  review_images        리뷰 이미지                                    │
│  points               적립금 이력                                    │
│  settlements          정산                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.2 핵심 테이블 ERD
```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│   members    │       │   products   │       │   orders     │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ id (PK)      │       │ id (PK)      │       │ id (PK)      │
│ email        │       │ seller_id(FK)│       │ order_number │
│ password     │       │ category_id  │       │ member_id(FK)│
│ name         │──┐    │ name         │──┐    │ status       │
│ phone        │  │    │ base_price   │  │    │ total_price  │
│ grade        │  │    │ status       │  │    │ delivery_fee │
│ point        │  │    │ delivery_type│  │    │ final_price  │
│ created_at   │  │    │ avg_rating   │  │    │ ordered_at   │
└──────────────┘  │    └──────────────┘  │    └──────────────┘
       │          │           │          │           │
       │          │           │          │           │
       ▼          │           ▼          │           ▼
┌──────────────┐  │    ┌──────────────┐  │    ┌──────────────┐
│  addresses   │  │    │product_opts  │  │    │ order_items  │
├──────────────┤  │    ├──────────────┤  │    ├──────────────┤
│ id (PK)      │  │    │ id (PK)      │  │    │ id (PK)      │
│ member_id(FK)│◀─┘    │ product_id   │◀─┘    │ order_id(FK) │
│ recipient    │       │ option_name  │       │ option_id(FK)│
│ phone        │       │ add_price    │       │ product_name │
│ address      │       │ is_available │       │ price        │
│ is_default   │       └──────────────┘       │ quantity     │
└──────────────┘              │               │ status       │
                              │               └──────────────┘
                              ▼
                       ┌──────────────┐
                       │ inventories  │
                       ├──────────────┤
                       │ id (PK)      │
                       │ option_id(FK)│
                       │ quantity     │
                       │ reserved_qty │
                       │ version      │
                       └──────────────┘
```

---

## 6. API 명세

### 6.1 API 버전 관리
- URL Path 방식: `/api/v1/...`
- 버전 업그레이드 시 이전 버전 6개월 유지

### 6.2 공통 응답 형식
```json
{
  "success": true,
  "data": { ... },
  "error": null,
  "timestamp": "2025-12-19T10:30:00Z"
}

// 에러 응답
{
  "success": false,
  "data": null,
  "error": {
    "code": "PRODUCT_NOT_FOUND",
    "message": "상품을 찾을 수 없습니다.",
    "details": null
  },
  "timestamp": "2025-12-19T10:30:00Z"
}
```

### 6.3 에러 코드 체계
| 코드 범위 | 카테고리 |
|----------|---------|
| 1000-1999 | 인증/인가 오류 |
| 2000-2999 | 회원 관련 오류 |
| 3000-3999 | 상품 관련 오류 |
| 4000-4999 | 주문 관련 오류 |
| 5000-5999 | 결제 관련 오류 |
| 9000-9999 | 시스템 오류 |

### 6.4 주요 API 목록

#### 인증 API
```
POST   /api/v1/auth/signup              회원가입
POST   /api/v1/auth/login               로그인
POST   /api/v1/auth/logout              로그아웃
POST   /api/v1/auth/refresh             토큰 갱신
POST   /api/v1/auth/password/reset      비밀번호 재설정
```

#### 회원 API
```
GET    /api/v1/members/me               내 정보 조회
PUT    /api/v1/members/me               내 정보 수정
GET    /api/v1/members/me/addresses     배송지 목록
POST   /api/v1/members/me/addresses     배송지 추가
PUT    /api/v1/members/me/addresses/{id}   배송지 수정
DELETE /api/v1/members/me/addresses/{id}   배송지 삭제
GET    /api/v1/members/me/points        적립금 내역
GET    /api/v1/members/me/coupons       보유 쿠폰 목록
```

#### 상품 API
```
GET    /api/v1/products                 상품 목록 (검색, 필터, 정렬)
GET    /api/v1/products/{id}            상품 상세
GET    /api/v1/products/{id}/options    상품 옵션 목록
GET    /api/v1/products/{id}/reviews    상품 리뷰 목록
GET    /api/v1/categories               카테고리 목록 (트리)
GET    /api/v1/categories/{id}/products 카테고리별 상품
```

#### 장바구니 API
```
GET    /api/v1/cart                     장바구니 조회
POST   /api/v1/cart/items               장바구니 추가
PUT    /api/v1/cart/items/{id}          수량 변경
DELETE /api/v1/cart/items/{id}          장바구니 삭제
PUT    /api/v1/cart/items/{id}/select   선택/해제
DELETE /api/v1/cart/items/selected      선택 삭제
```

#### 주문 API
```
POST   /api/v1/orders                   주문 생성
GET    /api/v1/orders                   주문 목록
GET    /api/v1/orders/{orderNumber}     주문 상세
POST   /api/v1/orders/{orderNumber}/cancel   주문 취소
POST   /api/v1/orders/{orderNumber}/items/{id}/cancel  부분 취소
POST   /api/v1/orders/{orderNumber}/confirm  구매 확정
POST   /api/v1/orders/{orderNumber}/return   반품 요청
GET    /api/v1/orders/{orderNumber}/delivery 배송 조회
```

#### 결제 API
```
POST   /api/v1/payments                 결제 요청
POST   /api/v1/payments/confirm         결제 승인 (PG 콜백)
GET    /api/v1/payments/{id}            결제 정보 조회
POST   /api/v1/payments/{id}/cancel     결제 취소
```

#### 리뷰 API
```
POST   /api/v1/reviews                  리뷰 작성
PUT    /api/v1/reviews/{id}             리뷰 수정
DELETE /api/v1/reviews/{id}             리뷰 삭제
GET    /api/v1/reviews/writable         작성 가능한 리뷰 목록
GET    /api/v1/members/me/reviews       내 리뷰 목록
```

---

## 7. 개발 단계별 계획

### Phase 1: 핵심 구매 플로우 (MVP)
| 항목 | 세부 내용 |
|------|----------|
| **인프라** | Docker, MySQL, Redis 셋업 |
| **인증** | 회원가입, 로그인, JWT 인증 |
| **회원** | 회원 정보 관리, 배송지 관리 |
| **상품** | 상품 목록/상세, 카테고리, 옵션 |
| **재고** | 재고 관리, 동시성 제어 |
| **장바구니** | 담기, 수량 변경, 삭제 |
| **주문** | 주문 생성, 상태 관리, 취소 |
| **결제** | PG 연동 (토스페이먼츠), 결제/환불 |
| **배송** | 배송 상태 관리 |

### Phase 2: 확장 기능
| 항목 | 세부 내용 |
|------|----------|
| **쿠폰** | 쿠폰 발급, 적용, 중복 규칙 |
| **적립금** | 적립/사용, 등급별 적립률 |
| **리뷰** | 리뷰 작성, 포토/동영상 리뷰 |
| **검색** | Elasticsearch 기반 상품 검색 |
| **알림** | 이메일/푸시 알림 |
| **반품/환불** | 반품 프로세스, 환불 처리 |

### Phase 3: 고도화
| 항목 | 세부 내용 |
|------|----------|
| **와우 멤버십** | 멤버십 가입, 혜택 적용 |
| **판매자** | 판매자 센터, 상품 관리, 정산 |
| **추천** | 개인화 추천 시스템 |
| **성능 최적화** | 캐싱, 쿼리 최적화, CDN |
| **MSA 전환** | 서비스 분리, 이벤트 기반 통신 |

---

## 8. 용어 정의 (Glossary)

| 용어 | 정의 |
|------|------|
| 로켓배송 | 쿠팡 물류센터에서 직접 배송하는 서비스 |
| 로켓프레시 | 신선식품 새벽배송 서비스 |
| 와우 멤버십 | 월정액 유료 멤버십, 다양한 혜택 제공 |
| SKU | Stock Keeping Unit, 재고 관리 단위 |
| PG | Payment Gateway, 결제 대행사 |
| 구매확정 | 배송완료 후 반품 포기를 의미하는 최종 확정 |
| 정산 | 판매 금액에서 수수료를 제외한 금액을 판매자에게 지급 |

---

## 9. 참고 자료

- [쿠팡 기술 블로그](https://medium.com/coupang-engineering)
- [Spring WebFlux 공식 문서](https://docs.spring.io/spring-framework/reference/web/webflux.html)
- [R2DBC 공식 문서](https://r2dbc.io/)
- [토스페이먼츠 개발자센터](https://developers.tosspayments.com/)

---

**Document Owner**: Development Team
**Last Review Date**: 2025-12-19
**Next Review Date**: 2026-01-19
